<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://kallenosf.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://kallenosf.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2024-11-18T22:38:11+00:00</updated><id>https://kallenosf.github.io/feed.xml</id><title type="html">blank</title><subtitle>A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. </subtitle><entry><title type="html">Race Condition Bug in the Most Popular Greek E-Commerce App</title><link href="https://kallenosf.github.io/blog/2024/bug-bounty/" rel="alternate" type="text/html" title="Race Condition Bug in the Most Popular Greek E-Commerce App"/><published>2024-11-17T14:14:00+00:00</published><updated>2024-11-17T14:14:00+00:00</updated><id>https://kallenosf.github.io/blog/2024/bug-bounty</id><content type="html" xml:base="https://kallenosf.github.io/blog/2024/bug-bounty/"><![CDATA[<p><strong>TL;DR :</strong> I found a race-condition bug in a popular greek e-commerce app, that allowed me to redeem the <u>same gift-card twice</u>.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/bug-bounty/race-conditions-480.webp 480w,/assets/img/bug-bounty/race-conditions-800.webp 800w,/assets/img/bug-bounty/race-conditions-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/bug-bounty/race-conditions.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <h2 id="race-conditions">Race conditions</h2> <ul> <li>Back in September 2023, Portswigger published <a href="https://portswigger.net/web-security/race-conditions">content</a> in their web-security academy about race condition vulnerabilities, so I wanted to try it in the real world.</li> <li><u>Race conditions</u> usually occurr when websites handle requests <strong>in parallel without adequate safeguards</strong>, leading to ‚Äúcollisions‚Äù that result in unintended behavior.</li> <li>This type of vulnerability is similar to <strong>business logic</strong> flaws.</li> <li>In a race condition attack, an attacker sends <strong>carefully timed</strong> requests to <strong>intentionally create collisions</strong> and exploit the resulting unintended behavior for malicious purposes.</li> </ul> <h3 id="limit-overrun-race-conditions">Limit overrun race conditions</h3> <ul> <li>The most common type of race condition allows an attacker to <strong>bypass some kind of limit</strong> imposed by the application‚Äôs business logic.</li> <li>For instance, consider an e-shop where a customer wants to use a <strong>one-time</strong> discount code. The application might handle the process as follows:</li> </ul> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/bug-bounty/race-conditions1-480.webp 480w,/assets/img/bug-bounty/race-conditions1-800.webp 800w,/assets/img/bug-bounty/race-conditions1-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/bug-bounty/race-conditions1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <ul> <li>Now consider what would happen if a user who has never applied this discount code before tried to apply it <strong>twice at almost exactly the same time</strong>:</li> </ul> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/bug-bounty/race-conditions2-480.webp 480w,/assets/img/bug-bounty/race-conditions2-800.webp 800w,/assets/img/bug-bounty/race-conditions2-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/bug-bounty/race-conditions2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Images from Portswigger's web-security Academy </div> <ul> <li>The application enters a <strong>temporary sub-state</strong> during its operation.</li> <li>This sub-state <strong>starts</strong> when the server <u>begins</u> processing the <u>initial request</u> and <strong>ends</strong> once the <u>database is updated</u> to reflect that the discount code has been used.</li> <li>During this <strong>brief window, a race condition occurs</strong>, allowing users to repeatedly claim the discount multiple times.</li> <li>There are many variations of this kind of attack, including: <ul> <li>Redeeming a gift card multiple times (üòâ)</li> <li>Rating a product multiple times</li> <li>Withdrawing or transferring cash in excess of your account balance</li> <li>Reusing a single CAPTCHA solution</li> <li>Bypassing an anti-brute-force rate limit</li> </ul> </li> </ul> <h2 id="testing-for-race-condition-vulnerabilities">Testing for race condition vulnerabilities</h2> <h3 id="understanding-the-gift-card-functionality">Understanding the gift card functionality</h3> <ul> <li>The app allows users to <strong>purchase gift cards</strong>, so I bought one to test for any potential limit overruns.</li> <li>I noticed that the gift card was <strong>not linked to any specific account</strong>, likely to allow it to be gifted to anyone.</li> <li>I created <strong>three different accounts</strong> and confirmed that all of them could apply the gift card code during checkout, though not simultaneously.</li> </ul> <h3 id="discovering-race-conditions">Discovering race conditions</h3> <ul> <li>During checkout, when a user added a coupon, a <code class="language-plaintext highlighter-rouge">POST</code> request whas being sent to the <code class="language-plaintext highlighter-rouge">/coupons/claim.json</code> endpoint, containing the code in a JSON, such as <code class="language-plaintext highlighter-rouge">{"code":"XXXXXXX"}</code>.</li> <li>I sent this request to <strong>Burp Repeater</strong>, for each session from all three accounts (I used three different browsers to create <strong>separate sessions</strong>, one for each account - although this could also be done in the same browser using a browser extension).</li> <li>Burp Repeater allows you to create a <strong>tab group</strong> and add <strong>multiple requests</strong> together.</li> </ul> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/bug-bounty/race-conditions3-480.webp 480w,/assets/img/bug-bounty/race-conditions3-800.webp 800w,/assets/img/bug-bounty/race-conditions3-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/bug-bounty/race-conditions3.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <ul> <li>Once I added all three requests to the group tab, I sent them in <strong>parallel</strong>.</li> <li>Sending requests in parallel requires <u>Burp Suite 2023.9 or later!</u></li> </ul> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/bug-bounty/race-conditions4-480.webp 480w,/assets/img/bug-bounty/race-conditions4-800.webp 800w,/assets/img/bug-bounty/race-conditions4-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/bug-bounty/race-conditions4.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/bug-bounty/race-conditions5-480.webp 480w,/assets/img/bug-bounty/race-conditions5-800.webp 800w,/assets/img/bug-bounty/race-conditions5-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/bug-bounty/race-conditions5.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <ul> <li>By observing the responses, I discovered that the coupon was applied to <strong>more than one</strong> account!</li> </ul> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/bug-bounty/race-conditions6-480.webp 480w,/assets/img/bug-bounty/race-conditions6-800.webp 800w,/assets/img/bug-bounty/race-conditions6-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/bug-bounty/race-conditions6.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/bug-bounty/race-conditions7-480.webp 480w,/assets/img/bug-bounty/race-conditions7-800.webp 800w,/assets/img/bug-bounty/race-conditions7-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/bug-bounty/race-conditions7.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <ul> <li>While I couldn‚Äôt get the coupon to apply to all three accounts simultaneously, 90% of the time, it was <strong>successfully</strong> applied to two of the three.</li> <li>I did not attempt to complete a purchase, but I verified that you can proceed through the entire checkout process up to the payment step. Therefore, <strong>this vulnerability is exploitable</strong>.</li> </ul> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/bug-bounty/race-conditions8-480.webp 480w,/assets/img/bug-bounty/race-conditions8-800.webp 800w,/assets/img/bug-bounty/race-conditions8-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/bug-bounty/race-conditions8.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <ul> <li>The maximum amount for a gift card that can be purchased is <strong>‚Ç¨150</strong>, so an attacker could pay ‚Ç¨150 and use it to buy <strong>‚Ç¨300</strong> worth of items.</li> </ul> <h3 id="reporting">Reporting</h3> <ul> <li>This app has a bug bounty program in <a href="https://www.bugcrowd.com/">BugCrowd</a>, so I reported the issue there.</li> <li>At first, they couldn‚Äôt reproduce the issue and requested some PoC videos, which I provided.</li> <li>The bug was classified as a <code class="language-plaintext highlighter-rouge">P3</code> and I was awarded <code class="language-plaintext highlighter-rouge">$650</code>.</li> </ul> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/bug-bounty/race-conditions9-480.webp 480w,/assets/img/bug-bounty/race-conditions9-800.webp 800w,/assets/img/bug-bounty/race-conditions9-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/bug-bounty/race-conditions9.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div>]]></content><author><name></name></author><category term="web"/><category term="bug-bounty"/><category term="race-condition"/><summary type="html"><![CDATA[an example of a blog post with table of contents on a sidebar]]></summary></entry></feed>